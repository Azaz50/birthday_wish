<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday Neha â€” my Gulabo Rani</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: radial-gradient(circle at 20% 10%, #ffefff, #ffe7f1 30%, #f9d3ff 60%, #c9e7ff 100%);
      --primary: #ff3b7b;
      --accent: #7c3aed;
      --gold: #ffd166;
      --mint: #2dd4bf;
      --shadow: 0 10px 30px rgba(0,0,0,.15);
    }
    *{box-sizing: border-box}
    html,body{height:100%; margin:0; padding:0;}
    body{ font-family: 'Poppins', sans-serif; color:#1f2937; background: var(--bg); overflow-x:hidden; }

    /* layout */
    .stars{position: fixed; inset:0; pointer-events:none; opacity:.25; background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 40px 40px; animation: twinkle 6s linear infinite;}
    @keyframes twinkle{ from{transform:translateY(0)} to{transform:translateY(-40px)} }
    header{text-align:center; padding:18px 14px 6px}
    .title{font-family:'Pacifico', cursive; font-size: clamp(26px, 7vw, 52px); margin:0; color:#111827;}
    .subtitle{margin:6px 0 0; font-weight:600; color:var(--accent); font-size: clamp(14px, 3.8vw, 20px);}

    .hero{display:grid; grid-template-columns: 1.1fr .9fr; gap:18px; max-width:1100px; margin:12px auto; padding: 0 18px;}
    @media (max-width:900px){ .hero{grid-template-columns:1fr; text-align:center} }

    .card{background:#ffffffdd; backdrop-filter: blur(8px); border-radius: 18px; padding: 18px; box-shadow: var(--shadow);}    

    /* cake stage */
    .stage{ position:relative; height:360px; display:flex; align-items:flex-end; justify-content:center; overflow:visible; }
    @media (max-width:480px){ .stage{ height:300px } }
    .plate{position:absolute; bottom:12px; width:90%; max-width:520px; height:18px; border-radius:12px; background:#f0f4ff; box-shadow: inset 0 -6px 0 #d8e2ff, 0 8px 18px rgba(0,0,0,.12);}    
    svg.cake{ width:100%; max-width:420px; height:auto; filter: drop-shadow(0 12px 18px rgba(0,0,0,.18)); display:block; margin: 0 auto }

    .flame { transform-origin: 50% 100%; animation: flicker .12s infinite alternate ease-in-out; }
    @keyframes flicker { from{ transform: scaleY(1) translateX(-.5px)} to{ transform: scaleY(1.06) translateX(.8px)} }
    .glow { filter: blur(6px); opacity:.6; animation: glow 1.5s ease-in-out infinite alternate; }
    @keyframes glow { from{opacity:.35} to{opacity:.75} }

    .balloon{ position:absolute; bottom:-120px; font-size: 44px; filter: drop-shadow(0 6px 8px rgba(0,0,0,.2)); animation: float 8s linear infinite; }
    .b1{ left:4%; animation-duration: 8s}
    .b2{ left:20%; animation-duration: 10s}
    .b3{ left:38%; animation-duration: 11s}
    .b4{ left:62%; animation-duration: 12s}
    .b5{ left:80%; animation-duration: 13s}
    @keyframes float { 0%{ transform: translateY(0) } 100%{ transform: translateY(-120vh) } }

    .controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:14px;}
    .btn{appearance:none; border:none; padding:10px 14px; border-radius: 999px; cursor:pointer; font-weight:600; letter-spacing:.2px; background: linear-gradient(135deg, var(--primary), #ff809f); color:white; box-shadow: var(--shadow); transition: transform .15s ease, box-shadow .15s ease, filter .15s ease; }
    .btn:hover{ transform: translateY(-2px); filter: brightness(1.05)}
    .btn.secondary{ background: linear-gradient(135deg, var(--accent), #a78bfa)}
    .btn.ghost{ background:#fff; color:#374151; border:1px solid #e5e7eb }

    .message.card{ margin-top:12px }
    .type{font-size: clamp(15px, 1.9vw, 18px); line-height:1.7; min-height:80px; white-space:pre-wrap;}
    .tag{ display:inline-block; padding:6px 10px; background:#fff; border:1px dashed #e5e7eb; border-radius: 999px; font-size:12px; margin-top:10px; }

    canvas#confetti{ position:fixed; inset:0; pointer-events:none }

    .heart{ position: fixed; pointer-events:none; font-size: 18px; animation: pop 1.2s ease forwards; opacity:.9; }
    @keyframes pop{ 0%{ transform: translate(-50%, -50%) scale(.6); opacity:1 } 100%{ transform: translate(-50%,-120%) scale(1.6); opacity:0 } }

    footer{ text-align:center; padding:18px; color:#6b7280; font-size:13px }
  </style>
</head>
<body>
  <div class="stars" aria-hidden="true"></div>
  <header>
    <h1 class="title">Happy Birthday, <span style="color:var(--primary)">Neha</span> ğŸ‰</h1>
    <p class="subtitle">To my Gulabo Rani â€” with love ğŸ’–</p>
  </header>

  <main class="hero">
    <section class="card">
      <div class="stage" role="img" aria-label="Birthday cake scene">
        <div class="plate" aria-hidden="true"></div>

        <!-- Balloons -->
        <div class="balloon b1" aria-hidden="true">ğŸˆ</div>
        <div class="balloon b2" aria-hidden="true">ğŸˆ</div>
        <div class="balloon b3" aria-hidden="true">ğŸˆ</div>
        <div class="balloon b4" aria-hidden="true">ğŸˆ</div>
        <div class="balloon b5" aria-hidden="true">ğŸˆ</div>

        <!-- Cake (SVG) -->
        <svg class="cake" viewBox="0 0 420 360" xmlns="http://www.w3.org/2000/svg" aria-label="Birthday cake">
          <ellipse cx="210" cy="330" rx="120" ry="16" fill="#e5e7eb"/>
          <rect x="70" y="220" width="280" height="80" rx="18" fill="#ffd1dc"/>
          <rect x="70" y="250" width="280" height="18" fill="#ffe4ec"/>
          <rect x="95" y="160" width="230" height="70" rx="16" fill="#ffc4e1"/>
          <rect x="95" y="188" width="230" height="14" fill="#ffe4ec"/>
          <rect x="125" y="118" width="170" height="52" rx="14" fill="#ffbcd4"/>
          <g fill="#fff">
            <circle cx="120" cy="175" r="3"/>
            <circle cx="150" cy="185" r="3"/>
            <circle cx="180" cy="170" r="3"/>
            <circle cx="240" cy="180" r="3"/>
            <circle cx="280" cy="172" r="3"/>
            <circle cx="230" cy="138" r="3"/>
            <circle cx="180" cy="140" r="3"/>
            <circle cx="260" cy="145" r="3"/>
          </g>
          <rect id="candle" x="202" y="84" width="16" height="40" rx="4" fill="#7c3aed"/>
          <rect x="202" y="118" width="16" height="6" rx="3" fill="#a78bfa"/>
          <rect id="wick" x="209.5" y="74" width="2.8" height="12" rx="1" fill="#111827"/>
          <g id="flameGroup" style="display:none">
            <path class="flame" d="M211 54 q-12 16 0 28 q12-12 0-28z" fill="#ffb703"/>
            <path class="flame glow" d="M211 54 q-12 16 0 28 q12-12 0-28z" fill="#ffd166"/>
          </g>
        </svg>
      </div>

      <div class="controls" role="region" aria-label="Cake controls">
        <button class="btn" id="lightBtn" aria-pressed="false">ğŸ•¯ï¸ Light Candle</button>
        <button class="btn secondary" id="blowBtn">ğŸŒ¬ï¸ Make a Wish</button>
        <button class="btn ghost" id="confettiBtn">ğŸŠ Confetti</button>
        <button class="btn" id="soundBtn">ğŸ”Š Play Wish</button>
        <button class="btn ghost" id="stopSoundBtn">â¹ï¸ Stop</button>
      </div>
    </section>

    <section class="message card">
      <h2 style="margin-top:0">Dear Neha ğŸŒ¸</h2>
      <div class="type" id="typebox" aria-live="polite"></div>
      <span class="tag">from: Your Love â€” to: my Gulabo Rani ğŸ’</span>
    </section>
  </main>

  <canvas id="confetti"></canvas>
  <footer>Made with â¤ï¸ for Neha â€¢ Tap/Click anywhere to pop hearts</footer>

  <script>
    /* ==================================================
       Fix summary:
       The previous error (NotSupportedError) came from trying to play
       an external audio resource that the browser rejected. To avoid
       that we now use the Web Speech API (speechSynthesis) for the
       vocal "Happy Birthday my Gulabo Rani" line and the Web Audio
       API to synthesize a short melody locally. This avoids
       unsupported external audio formats and cross-origin problems.
       ================================================== */

    // ===== Typewriter message =====
    const msg = `Happy Birthday, Neha!\n\n"my Gulabo Rani", tumhari muskurahat mere din ka sabse sundar hissa hai.\nAaj ke din tumhare liye duaa hai â€” zindagi me har khushi mile, har sapna poora ho,\naur tumhara dil hamesha itna hi pyara rahe.\n\nBlow the candle, make a wish, and let the magic begin âœ¨`;
    const box = document.getElementById('typebox');
    let i = 0;
    function type() { if(i <= msg.length){ box.textContent = msg.slice(0,i++); setTimeout(type, 24);} }
    type();

    // ===== Candle controls =====
    const flameGroup = document.getElementById('flameGroup');
    const lightBtn = document.getElementById('lightBtn');
    const blowBtn  = document.getElementById('blowBtn');
    let lit = false;

    lightBtn.addEventListener('click', () => {
      if (flameGroup.style.display === 'none' || flameGroup.style.display === '') {
        flameGroup.style.display = 'block';
        lightBtn.setAttribute('aria-pressed','true');
        lit = true;
        pulseCake();
        emitConfetti(160);
      } else {
        flameGroup.style.display = 'none';
        lightBtn.setAttribute('aria-pressed','false');
        lit = false;
        emitConfetti(80);
      }
    });

    blowBtn.addEventListener('click', () => {
      if(lit){
        flameGroup.animate([{opacity:1},{opacity:0}], {duration:400, fill:'forwards'}).onfinish = () => {
          flameGroup.style.display = 'none'; lightBtn.setAttribute('aria-pressed','false'); lit = false; emitConfetti(240);
        };
      } else { emitConfetti(160); }
    });

    function pulseCake(){ document.querySelector('.cake').animate([{transform:'scale(1)'}, {transform:'scale(1.03)'}, {transform:'scale(1)'}], {duration:500, easing:'ease'}); }

    // ===== Confetti (unchanged) =====
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let W, H; function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; } addEventListener('resize', resize); resize();

    function emitConfetti(count = 140){
      const particles = [];
      for(let i=0;i<count;i++){
        particles.push({x: W/2, y: H/3, r: Math.random()*6+2, vx: (Math.random()-0.5)*6, vy: Math.random()*-8-4, a: Math.random()*Math.PI, life: 120+Math.random()*40});
      }
      const colors = ['#ff3b7b','#7c3aed','#ffd166','#2dd4bf','#60a5fa','#34d399'];
      let frame = 0;
      const tick = () => {
        ctx.clearRect(0,0,W,H);
        particles.forEach(p =>{ p.x += p.vx; p.y += p.vy; p.vy += 0.15; p.a += 0.2; p.life--; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a); ctx.fillStyle = colors[(Math.abs((p.life>>2)+frame))%colors.length]; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r*1.4); ctx.restore(); });
        frame++;
        if(particles.some(p=>p.life>0)) requestAnimationFrame(tick); else ctx.clearRect(0,0,W,H);
      };
      tick();
    }

    document.getElementById('confettiBtn').addEventListener('click', () => emitConfetti());

    // ===== Heart trail =====
    const hearts = ['â¤','ğŸ’–','ğŸ’—','ğŸ’“','ğŸ’','ğŸ’˜'];
    window.addEventListener('pointerdown', popHeart);
    window.addEventListener('pointermove', e => { if(e.pressure>0 || e.buttons) popHeart(e)});
    function popHeart(e){ const h = document.createElement('div'); h.className = 'heart'; h.textContent = hearts[Math.random()*hearts.length|0]; h.style.left = e.clientX+'px'; h.style.top = e.clientY+'px'; document.body.appendChild(h); setTimeout(()=> h.remove(), 1300); }

    setTimeout(()=> emitConfetti(220), 800);

    /* ===== SOUND: Web Speech + Web Audio fallback =====
       Strategy:
       1) Use speechSynthesis to say the custom vocal wish.
       2) Use Web Audio API to synthesize a short "Happy Birthday" melody locally.
       3) Provide a Stop button that cancels speech and stops the melody.
       This avoids loading external audio files that may trigger NotSupportedError.
    */

    const soundBtn = document.getElementById('soundBtn');
    const stopBtn = document.getElementById('stopSoundBtn');
    let audioCtx = null; // AudioContext used for melody
    let scheduledClose = null;

    function speakText(text){
      try{
        if('speechSynthesis' in window){
          // Cancel any previous utterances
          window.speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(text);
          u.lang = 'en-US';
          u.rate = 1; // normal speed
          u.pitch = 1.05; // slightly warm
          window.speechSynthesis.speak(u);
          return true;
        }
        return false;
      }catch(err){ console.warn('speechSynthesis error', err); return false; }
    }

    // Melody notes (approx) for "Happy Birthday"
    const melodyNotes = [
      {f:392, d:0.35},{f:392, d:0.35},{f:440, d:0.6},{f:392, d:0.6},{f:523.25, d:0.6},{f:493.88, d:0.9},
      {f:392, d:0.35},{f:392, d:0.35},{f:440, d:0.6},{f:392, d:0.6},{f:587.33, d:0.6},{f:523.25, d:0.9},
      {f:392, d:0.35},{f:392, d:0.35},{f:784, d:0.6},{f:659.25, d:0.6},{f:523.25, d:0.4},{f:493.88, d:0.4},{f:440, d:0.9},
      {f:349.23, d:0.35},{f:349.23, d:0.35},{f:659.25, d:0.6},{f:523.25, d:0.6},{f:587.33, d:0.6},{f:523.25, d:0.9}
    ];

    function playMelody(){
      try{
        // create a fresh AudioContext on user gesture
        if(audioCtx && typeof audioCtx.close === 'function'){
          // if already playing, stop first
          audioCtx.close();
          audioCtx = null;
        }
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const gain = audioCtx.createGain(); gain.gain.value = 0.16; gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime + 0.05;
        let offset = 0;
        const oscillators = [];
        for(const note of melodyNotes){
          const o = audioCtx.createOscillator();
          // use triangle for a sweet, mellow tone
          o.type = 'triangle';
          o.frequency.value = note.f;
          o.connect(gain);
          const start = now + offset;
          const stop = start + note.d * 0.95;
          o.start(start);
          o.stop(stop);
          oscillators.push(o);
          offset += note.d;
        }
        // schedule a close after melody ends
        const total = offset;
        if(scheduledClose) clearTimeout(scheduledClose);
        scheduledClose = setTimeout(()=>{
          if(audioCtx && typeof audioCtx.close === 'function') audioCtx.close();
          audioCtx = null;
        }, (total + 0.3) * 1000);
        return true;
      }catch(err){ console.warn('WebAudio error', err); return false; }
    }

    function stopAllSound(){
      try{
        // stop speech
        if('speechSynthesis' in window) window.speechSynthesis.cancel();
        // stop melody
        if(scheduledClose) { clearTimeout(scheduledClose); scheduledClose = null; }
        if(audioCtx && typeof audioCtx.close === 'function'){
          audioCtx.close(); audioCtx = null;
        }
      }catch(err){ console.warn('stopAllSound error', err); }
    }

    soundBtn.addEventListener('click', async () => {
      // On click: speak the wish, then play melody. Both are user-gesture initiated.
    //   const said = speakText('Happy Birthday, my Gulabo Rani. Wishing you joy, love and endless smiles.');
      const played = playMelody();
      // If both failed (older browser), show a message
      if(!said && !played){
        alert('Audio not supported in this browser. Try a modern browser (Chrome, Firefox, Edge, Safari).');
      }
    });

    stopBtn.addEventListener('click', () => stopAllSound());

    // ===== small accessibility improvement: space / enter activate buttons =====
    [lightBtn, blowBtn, document.getElementById('confettiBtn'), soundBtn, stopBtn].forEach(b => {
      b.addEventListener('keyup', (e) => { if(e.key === ' ' || e.key === 'Enter') b.click(); });
    });

    // Clean up audio resources when page is hidden/unloaded
    document.addEventListener('visibilitychange', () => { if(document.hidden) stopAllSound(); });
    window.addEventListener('pagehide', () => stopAllSound());

    window.addEventListener('DOMContentLoaded', () => {
      playMelody();
    });

    // ===== Shayari cycling =====
    const shayariList = [
      `Teri muskaan meri duaon ka asar hai,\nTere bina mera dil kuch be-asar hai.\nKhuda kare har janam tujhe paau main,\nMeri Gulabo Rani, tu meri duniya ka safar hai.\nğŸ‚ğŸ’ğŸ¶\nHappy Birthday My Gulabo Rani`,
      `Zindagi tere pyaar se roshan hai,\nDil ki dhadkan teri tasveer hai.\nTujhe paake lagta hai mujhe,\nJaise meri duniya ek khubsurat taqdeer hai. ğŸ‚âœ¨`,
      `Tu meri duaon ka noor hai,\nTu mere khwabon ka surur hai.\nMeri Gulabo Rani, tujhe paake lagta hai,\nJaise meri mohabbat ka raboor hai. ğŸ’–`
    ];
    let shayariIndex = 0;
    function typeShayari(msg) {
      let i = 0;
      box.textContent = '';
      function type() {
        if(i <= msg.length){
          box.textContent = msg.slice(0,i++);
          setTimeout(type, 24);
        }
      }
      type();
    }
    function cycleShayari() {
      typeShayari(shayariList[shayariIndex]);
      shayariIndex = (shayariIndex + 1) % shayariList.length;
      setTimeout(cycleShayari, 12000); // change every 6 seconds
    }
    cycleShayari();
  </script>
</body>
</html>
